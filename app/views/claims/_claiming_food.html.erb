<div class="nf-claim-form-card">
  <h1 class="nf-claim-form-title">
    Claim <span class="nf-claim-form-title-accent"><%= food.title %></span>
  </h1>

  <% if food.photos.attached? %>
    <p style="margin-bottom: 12px;">
      <%= image_tag food.photos.first, alt: food.title, class: "nf-claim-media" %>
    </p>
  <% end %>

  <p class="nf-claim-form-subtitle">
    <%= food.description %>
  </p>

  <p>
    Collect on <strong><%= food.start_time.to_date.strftime("%d %b %Y") %></strong><br>
    Between <strong><%= food.start_time.strftime("%H:%M") %></strong>
    and <strong><%= food.end_time.strftime("%H:%M") %></strong>.
  </p>

  <%= form_with model: [food, Claim.new], data: { turbo_stream: true } do |form| %>
    <div class="nf-claim-form-body">

      <% times = (local_assigns[:available_times] || @available_times || []) %>

      <div class="nf-claim-time-row">

        <div class="nf-claim-time-label">
          <%= form.label :collect_time do %>
            <strong>Select a collection time:</strong>
          <% end %>
        </div>

        <div class="nf-custom-select" data-controller="nfselect">
          <button type="button" class="nf-custom-select-trigger" data-action="click->nfselect#toggle">
            <span data-nfselect-target="label">Select a time</span>
          </button>

          <ul class="nf-custom-select-options" data-nfselect-target="options">
            <% times.each do |t| %>
              <% value = t.strftime("%H:%M") %>
              <li data-action="click->nfselect#choose" data-value="<%= value %>"><%= value %></li>
            <% end %>
          </ul>

          <%= form.hidden_field :collect_time, data: { nfselect_target: "hidden" } %>
        </div>

      </div>

      <% if times.empty? %>
        <p class="nf-claim-form-helper" style="color: #d9534f; margin-top: 4px;">
          No available time slots.
        </p>
      <% end %>

    </div>

    <div class="nf-claim-form-actions">
      <%= form.submit "Claim Food", class: "nf-claim-btn" %>
      <%= link_to "See the details", food_path(food), class: "nf-chip nf-details-btn" %>
    </div>

  <% end %>
</div>
